package traceable.ai.demo;

import com.mongodb.client.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;


import com.mongodb.client.MongoClient;
import org.bson.Document;

@RestController
@RequestMapping("/people")
public class Controller {

    @Autowired
    private PeopleRepository peopleRepository;

    @GetMapping
    public List<LoginRequest> getAllPeople() {
        MongoClient mongoClient = MongoClients.create("mongodb://localhost:27017");
        MongoDatabase database = mongoClient.getDatabase("test");
        MongoCollection<Document> collection = database.getCollection("People");
        // Insert some dummy data into the collection
        Document doc1 = new Document("name", "John Doe")
                .append("age", 30)
                .append("id",1234)
                .append("email", "johndoe@example.com");
        Document doc2 = new Document("name", "Jane Doe")
                .append("age", 25)
                .append("id",1235)
                .append("email", "janedoe@example.com");
        Document doc3 = new Document("name", "Bob Smith")
                .append("age", 40)
                .append("id",1236)
                .append("email", "bobsmith@example.com");
        collection.insertMany(Arrays.asList(doc1, doc2, doc3));

        // Retrieve a specific document from the collection
        Document query = new Document("name", "John Doe");
        FindIterable<Document> result = collection.find(query);
        MongoCursor<Document> cursor = result.iterator();
        while (cursor.hasNext()) {
            Document document = cursor.next();
            System.out.println(document.toJson());
        }

        mongoClient.close();
        return peopleRepository.findAll();
    }

    @GetMapping("/{id}")
    public ResponseEntity<Document> getProductById(@PathVariable String id) {
        MongoClient mongoClient = MongoClients.create("mongodb://localhost:27017");
        MongoDatabase database = mongoClient.getDatabase("test");
        MongoCollection<Document> collection = database.getCollection("People");
        // Insert some dummy data into the collection
        Document doc1 = new Document("name", "John Doe")
                .append("age", 30)
                .append("id",1234)
                .append("username", "johndoe@example.com")
                .append("password", "johndoe@example.com");
        Document doc2 = new Document("name", "Jane Doe")
                .append("age", 25)
                .append("id",1235)
                .append("email", "janedoe@example.com")
                .append("password", "janedoe@example.com");
        Document doc3 = new Document("name", "Bob Smith")
                .append("age", 40)
                .append("id",1236)
                .append("email", "bobsmith@example.com");
        collection.insertMany(Arrays.asList(doc1, doc2, doc3));

        // Retrieve a specific document from the collection
        Document query = new Document("id", id);
        FindIterable<Document> result = collection.find(query);
        MongoCursor<Document> cursor = result.iterator();
        while (cursor.hasNext()) {
            Document document = cursor.next();
            System.out.println(document.toJson());
        }

        mongoClient.close();
        return ResponseEntity.ok(new Document());
    }

    @PutMapping("/{id}")
    public ResponseEntity<Document> updateProduct(@PathVariable String id, @RequestBody LoginRequest person) {
        Document doc3 = new Document("name", person.getName())
                .append("age", person.getAge())
                .append("id",person.getId())
                .append("email", person.getUsername());

        MongoClient mongoClient = MongoClients.create("mongodb://localhost:27017");
        MongoDatabase database = mongoClient.getDatabase("test");
        MongoCollection<Document> collection = database.getCollection("People");
        collection.insertOne(doc3);
        return ResponseEntity.ok(doc3);
    }

    @PostMapping
    public ResponseEntity<LoginRequest> addProduct(@RequestBody LoginRequest product) {
        LoginRequest savedProduct = peopleRepository.save(product);
        return ResponseEntity.status(HttpStatus.CREATED).body(savedProduct);
    }


}